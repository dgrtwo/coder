<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Benchmarking • coder</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Benchmarking">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">coder</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">0.5.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/benchmark.html">Benchmarking</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/eribul/coder">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Benchmarking</h1>
                        <h4 class="author">Erik Bulow</h4>
            
            <h4 class="date">2018-03-06</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/eribul/coder/blob/master/vignettes/benchmark.Rmd"><code>vignettes/benchmark.Rmd</code></a></small>
      <div class="hidden name"><code>benchmark.Rmd</code></div>

    </div>

    
    
<div id="other-icd-packages" class="section level1">
<h1 class="hasAnchor">
<a href="#other-icd-packages" class="anchor"></a>Other ICD packages</h1>
<p>The <code>coder</code> package is not the only (nor the first) R package aimed for ICD codes and comorbitity indexes. Four additional packages (as listed below) were found as by 2016-04-14.</p>
<table class="table">
<colgroup>
<col width="19%">
<col width="17%">
<col width="5%">
<col width="25%">
<col width="31%">
</colgroup>
<thead><tr class="header">
<th>Package</th>
<th>Authour</th>
<th>CRAN</th>
<th>GitHub</th>
<th>ICD versions</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>icd</td>
<td>Jack Wasey</td>
<td>X</td>
<td>jackwasey/icd</td>
<td>ICD9, ICD10, ICD-10-CM</td>
</tr>
<tr class="even">
<td>medicalrisk</td>
<td>Patrick McCormick</td>
<td>X</td>
<td>patrickmdnet/medicalrisk</td>
<td>ICD-9-CM</td>
</tr>
<tr class="odd">
<td>comorbidities.icd10</td>
<td>Max Gordon</td>
<td></td>
<td>gforge/comorbidities.icd10</td>
<td>ICD-9, ICD-10 (US/SWE)</td>
</tr>
<tr class="even">
<td>icdcoder</td>
<td>Wade Cooper</td>
<td></td>
<td>wtcooper/icdcoder</td>
<td>ICD9, ICD-9-CM, ICD10, ICD-10-CM</td>
</tr>
</tbody>
</table>
</div>
<div id="packages-to-compare" class="section level1">
<h1 class="hasAnchor">
<a href="#packages-to-compare" class="anchor"></a>Packages to compare</h1>
<p>The <code>coder</code> package was initilly targeted for Swedish ICD data. Since Sweden (as opposed to USA) use mostly ICD-10 codes (in favour of ICD-9), the <code>medicalrisk</code> package is dropped from further comparisons.</p>
<p>The <code>icdcoder</code> package is not submitted to CRAN and inspection of the source code reveals that the package does not yet seem to be ready for production release (it does for example have some problems with its dependency packages). According to GitHub metrics, the development activity has been quite limited and we therefore assume that the package is not under active development. It is therefore not considered further within this comparison.</p>
</div>
<div id="speed-comparison" class="section level1">
<h1 class="hasAnchor">
<a href="#speed-comparison" class="anchor"></a>Speed comparison</h1>
<p>Calling functions from both <code>icd</code> and <code>comorbidities.icd10</code> by full reference (e. g. <code>package::fun</code>) is problematic due to internal use of non standard evaluation. All compared packages are therefore attached:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw">library</span>(coder)</a></code></pre></div>
<pre><code>## 
## Attaching package: 'coder'</code></pre>
<pre><code>## The following object is masked from 'package:methods':
## 
##     show</code></pre>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="kw">suppressPackageStartupMessages</span>(<span class="kw">library</span>(icd))</a>
<a class="sourceLine" id="cb4-2" data-line-number="2"><span class="kw">suppressPackageStartupMessages</span>(<span class="kw">library</span>(comorbidities.icd10))</a>
<a class="sourceLine" id="cb4-3" data-line-number="3"></a>
<a class="sourceLine" id="cb4-4" data-line-number="4"><span class="kw">library</span>(dplyr) <span class="co"># For data management</span></a></code></pre></div>
<pre><code>## 
## Attaching package: 'dplyr'</code></pre>
<pre><code>## The following objects are masked from 'package:stats':
## 
##     filter, lag</code></pre>
<pre><code>## The following objects are masked from 'package:base':
## 
##     intersect, setdiff, setequal, union</code></pre>
<p>Benchmarking will be performed by calculating Elixhauser comorbidity classes based on ICD-10 codes by corresponding functions from the <code>icd</code>, <code>coder</code> and <code>comorbidities.icd10</code> packages.</p>
<p>First some session info:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1">si &lt;-<span class="st"> </span>devtools<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/devtools/topics/session_info">session_info</a></span>(<span class="kw">c</span>(<span class="st">"icd"</span>, <span class="st">"coder"</span>, <span class="st">"comorbidities.icd10"</span>))</a>
<a class="sourceLine" id="cb8-2" data-line-number="2">si<span class="op">$</span>packages &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb8-3" data-line-number="3"><span class="st">  </span>si<span class="op">$</span>packages <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb8-4" data-line-number="4"><span class="st">  </span><span class="kw">filter</span>(package <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">"icd"</span>, <span class="st">"coder"</span>, <span class="st">"comorbidities.icd10"</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb8-5" data-line-number="5"><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>source)</a>
<a class="sourceLine" id="cb8-6" data-line-number="6">si</a></code></pre></div>
<pre><code>## Session info -------------------------------------------------------------</code></pre>
<pre><code>##  setting  value                       
##  version  R version 3.4.3 (2017-11-30)
##  system   x86_64, mingw32             
##  ui       RStudio (1.0.136)           
##  language (EN)                        
##  collate  Swedish_Sweden.1252         
##  tz       Europe/Berlin               
##  date     2018-03-06</code></pre>
<pre><code>## Packages -----------------------------------------------------------------</code></pre>
<pre><code>##               package * version       date
## 1           coder *   0.4.3 2017-08-17
## 2 comorbidities.icd10 *   0.6.2 2016-08-11
## 3                 icd *   2.3.1 2017-10-12</code></pre>
<p>We prepare a function to return a list with unevaluated calls to correspinding functions in specified packages:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1">uneval_list &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">pkgs =</span> <span class="kw">c</span>(<span class="st">"coder"</span>, <span class="st">"icd"</span>, <span class="st">"comorbidities.icd10"</span>)) {</a>
<a class="sourceLine" id="cb13-2" data-line-number="2">  </a>
<a class="sourceLine" id="cb13-3" data-line-number="3">  <span class="co"># Initiate a list of expressions to benchmark</span></a>
<a class="sourceLine" id="cb13-4" data-line-number="4">  expr &lt;-<span class="st"> </span><span class="kw">list</span>()</a>
<a class="sourceLine" id="cb13-5" data-line-number="5">  </a>
<a class="sourceLine" id="cb13-6" data-line-number="6">  <span class="co"># Include function "classify" from package "coder"</span></a>
<a class="sourceLine" id="cb13-7" data-line-number="7">  <span class="cf">if</span> (<span class="st">"coder"</span> <span class="op">%in%</span><span class="st"> </span>pkgs) expr<span class="op">$</span>coder &lt;-<span class="st"> </span><span class="kw">substitute</span>(</a>
<a class="sourceLine" id="cb13-8" data-line-number="8">    </a>
<a class="sourceLine" id="cb13-9" data-line-number="9">    <span class="kw"><a href="../reference/classify.html">classify</a></span>(</a>
<a class="sourceLine" id="cb13-10" data-line-number="10">      x, </a>
<a class="sourceLine" id="cb13-11" data-line-number="11">      <span class="dt">by =</span> <span class="st">"elix_icd10"</span>, </a>
<a class="sourceLine" id="cb13-12" data-line-number="12">      <span class="dt">id =</span> <span class="st">"id"</span>)</a>
<a class="sourceLine" id="cb13-13" data-line-number="13">    )</a>
<a class="sourceLine" id="cb13-14" data-line-number="14">  </a>
<a class="sourceLine" id="cb13-15" data-line-number="15">  <span class="co"># Include function "icd_comorbid" from package "icd"</span></a>
<a class="sourceLine" id="cb13-16" data-line-number="16">  <span class="cf">if</span> (<span class="st">"icd"</span> <span class="op">%in%</span><span class="st"> </span>pkgs) expr<span class="op">$</span>icd &lt;-<span class="st"> </span><span class="kw">substitute</span>( </a>
<a class="sourceLine" id="cb13-17" data-line-number="17">    </a>
<a class="sourceLine" id="cb13-18" data-line-number="18">    <span class="kw">icd_comorbid</span>(</a>
<a class="sourceLine" id="cb13-19" data-line-number="19">      dplyr<span class="op">::</span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(</a>
<a class="sourceLine" id="cb13-20" data-line-number="20">        x, </a>
<a class="sourceLine" id="cb13-21" data-line-number="21">        <span class="dt">id =</span> <span class="kw">as.character</span>(id), </a>
<a class="sourceLine" id="cb13-22" data-line-number="22">        <span class="dt">code =</span> <span class="kw">as.character</span>(code)), </a>
<a class="sourceLine" id="cb13-23" data-line-number="23">      icd10_map_quan_elix, </a>
<a class="sourceLine" id="cb13-24" data-line-number="24">      <span class="dt">visit_name =</span> <span class="st">"id"</span>, </a>
<a class="sourceLine" id="cb13-25" data-line-number="25">      <span class="dt">icd_name =</span> <span class="st">"code"</span>)</a>
<a class="sourceLine" id="cb13-26" data-line-number="26">    )</a>
<a class="sourceLine" id="cb13-27" data-line-number="27">  </a>
<a class="sourceLine" id="cb13-28" data-line-number="28">  <span class="co"># Include function "cmrbdt.calc" from package "comorbid.icd10"</span></a>
<a class="sourceLine" id="cb13-29" data-line-number="29">  <span class="cf">if</span> (<span class="st">"comorbidities.icd10"</span> <span class="op">%in%</span><span class="st"> </span>pkgs) expr<span class="op">$</span>comorbidities.icd10 &lt;-<span class="st"> </span><span class="kw">substitute</span>( </a>
<a class="sourceLine" id="cb13-30" data-line-number="30">    </a>
<a class="sourceLine" id="cb13-31" data-line-number="31">    <span class="kw">cmrbdt.calc</span>(</a>
<a class="sourceLine" id="cb13-32" data-line-number="32">      x, </a>
<a class="sourceLine" id="cb13-33" data-line-number="33">      <span class="st">"id"</span>, </a>
<a class="sourceLine" id="cb13-34" data-line-number="34">      <span class="st">"code"</span>, </a>
<a class="sourceLine" id="cb13-35" data-line-number="35">      <span class="kw">rep</span>(<span class="st">"10"</span>, <span class="kw">nrow</span>(x)), </a>
<a class="sourceLine" id="cb13-36" data-line-number="36">      <span class="dt">cmrbdt.finder_fn =</span> cmrbdt.finder.regex.elixhauser_Quan2005)</a>
<a class="sourceLine" id="cb13-37" data-line-number="37">    )</a>
<a class="sourceLine" id="cb13-38" data-line-number="38">  </a>
<a class="sourceLine" id="cb13-39" data-line-number="39">  expr</a>
<a class="sourceLine" id="cb13-40" data-line-number="40">}</a></code></pre></div>
<p>We make another function to use for benchmarking</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1">bm &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">pkgs =</span> <span class="kw">c</span>(<span class="st">"coder"</span>, <span class="st">"icd"</span>, <span class="st">"comorbidities.icd10"</span>), ...) {</a>
<a class="sourceLine" id="cb14-2" data-line-number="2">  microbenchmark<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/microbenchmark/topics/microbenchmark">microbenchmark</a></span>(<span class="dt">list =</span> <span class="kw">uneval_list</span>(pkgs), ...) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb14-3" data-line-number="3"><span class="st">  </span><span class="kw">summary</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb14-4" data-line-number="4"><span class="st">  </span>knitr<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/knitr/topics/kable">kable</a></span>(<span class="dt">digits =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb14-5" data-line-number="5">}</a></code></pre></div>
<p>We will use a randomly generated (totaly “fake”/non personal) dataset of size 10,000. This is of quite moderate size compared to real world data but will be sufficient for now.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1"><span class="kw">head</span>(x &lt;-<span class="st"> </span>dplyr<span class="op">::</span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/sample.html">sample_n</a></span>(coder<span class="op">::</span>ex_icd10, <span class="fl">1e4</span>, <span class="ot">TRUE</span>))</a></code></pre></div>
<pre><code>##                       id  code_date  code  hdia
## 1: el-Kaba, Abdul Maalik 2016-06-11  A191 FALSE
## 2:           Duin, River 2016-10-11  S822 FALSE
## 3:        Alvarez, Jacob 2016-05-14  N055 FALSE
## 4:   Linear, Christopher 2016-05-27 L309F FALSE
## 5:     Campbell, Kesnick 2016-02-20  M202 FALSE
## 6:         Smith, Ruasha 2016-05-05  N410 FALSE</code></pre>
<p>The test data set does contain some codes beginning in “UA”, “UB” and/or “UP”. These are valid codes in the Swedish ICD 10 (2016) version but will not be recognised as such by <code>comorbidities.icd10</code>. They must therefore be excluded in order to proced:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1">x &lt;-<span class="st"> </span>dplyr<span class="op">::</span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(x, <span class="op">!</span><span class="kw">grepl</span>(<span class="st">"U[ABP]"</span>, code))</a></code></pre></div>
<p>A data set of 9788 is now remaining.</p>
<p>Results in seconds:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1"><span class="kw">bm</span>(<span class="dt">times =</span> <span class="dv">5</span>, <span class="dt">unit =</span> <span class="st">"s"</span>)</a></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">expr</th>
<th align="right">min</th>
<th align="right">lq</th>
<th align="right">mean</th>
<th align="right">median</th>
<th align="right">uq</th>
<th align="right">max</th>
<th align="right">neval</th>
<th align="left">cld</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">coder</td>
<td align="right">0.07</td>
<td align="right">0.09</td>
<td align="right">0.12</td>
<td align="right">0.13</td>
<td align="right">0.13</td>
<td align="right">0.18</td>
<td align="right">5</td>
<td align="left">a</td>
</tr>
<tr class="even">
<td align="left">icd</td>
<td align="right">0.44</td>
<td align="right">0.45</td>
<td align="right">0.48</td>
<td align="right">0.45</td>
<td align="right">0.52</td>
<td align="right">0.54</td>
<td align="right">5</td>
<td align="left">b</td>
</tr>
<tr class="odd">
<td align="left">comorbidities.icd10</td>
<td align="right">13.15</td>
<td align="right">13.17</td>
<td align="right">13.22</td>
<td align="right">13.20</td>
<td align="right">13.28</td>
<td align="right">13.30</td>
<td align="right">5</td>
<td align="left">c</td>
</tr>
</tbody>
</table>
<p>Relative speed differences (with the fastest package used as reference):</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" data-line-number="1"><span class="kw">bm</span>(<span class="dt">times =</span> <span class="dv">5</span>, <span class="dt">unit =</span> <span class="st">"relative"</span>)</a></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">expr</th>
<th align="right">min</th>
<th align="right">lq</th>
<th align="right">mean</th>
<th align="right">median</th>
<th align="right">uq</th>
<th align="right">max</th>
<th align="right">neval</th>
<th align="left">cld</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">coder</td>
<td align="right">1.00</td>
<td align="right">1.00</td>
<td align="right">1.00</td>
<td align="right">1.00</td>
<td align="right">1.00</td>
<td align="right">1.00</td>
<td align="right">5</td>
<td align="left">a</td>
</tr>
<tr class="even">
<td align="left">icd</td>
<td align="right">6.26</td>
<td align="right">6.19</td>
<td align="right">6.21</td>
<td align="right">6.39</td>
<td align="right">6.16</td>
<td align="right">6.09</td>
<td align="right">5</td>
<td align="left">b</td>
</tr>
<tr class="odd">
<td align="left">comorbidities.icd10</td>
<td align="right">186.21</td>
<td align="right">184.76</td>
<td align="right">174.84</td>
<td align="right">183.07</td>
<td align="right">179.92</td>
<td align="right">147.97</td>
<td align="right">5</td>
<td align="left">c</td>
</tr>
</tbody>
</table>
<p>We thus conclude that <code>coder</code> is faster than its competitors!</p>
<div id="some-reasons-for-speed-differences" class="section level2">
<h2 class="hasAnchor">
<a href="#some-reasons-for-speed-differences" class="anchor"></a>Some reasons for speed differences</h2>
<ul>
<li>Both <code>icd</code> and <code>coder</code> relies on matrices, while <code>comorbidities.icd10</code> uses data frames. Matrices are generally faster both due to its simpler structure (in this case logical/boolean while the data frame can have different types of classes for each column) and since matrices can be handled effectively through underlying (sub R) numerical C/C++/Fortran librarys such as LAPACK and BLAS.</li>
<li>
<code>coder</code> relies on compact regular expressions for classification. <code>comorbidities.icd10</code> can use regular expressions too (as done above) but the format is less compact. <code>icd</code> uses “raw” ICD-10 codes and “search for each possible parent of the given code, up to the three digit ‘major’” (<a href="https://cran.r-project.org/web/packages/icd/vignettes/icd-10.html" class="uri">https://cran.r-project.org/web/packages/icd/vignettes/icd-10.html</a>). (It might however be recorded as a side note that the <code>icd</code> package does rely on a (much) faster procedure when used with ICD-9 codes.)</li>
</ul>
</div>
<div id="a-note-on-rro" class="section level2">
<h2 class="hasAnchor">
<a href="#a-note-on-rro" class="anchor"></a>A note on RRO</h2>
<p>Comparisons above shows result for the latest (released) R version (details shown above).</p>
<p>Even though we would not present any details here, the same benchamrk was performed also on the latest available version (3.2.4) of Revolution R Open (RRO) with both one and then multiple (4) cores. This was done on an Intel i7 machine (an architecture supposed to take full advantage of the Intel Math Kernel Library used by RRO).</p>
<p>There were no relevant difference observed between one and 4 kernels. The <code>icd</code> package did perform better with RRO while <code>coder</code> and <code>comorbidities.icd10</code> were performing worse. The ranking among the packages were the same as above although the magnitude of the relative differneces were decreased between <code>coder</code> and <code>icd</code>.</p>
</div>
</div>
<div id="output" class="section level1">
<h1 class="hasAnchor">
<a href="#output" class="anchor"></a>Output</h1>
<p>It is abviously important also to compare the output of each function. The basic output from all functions is a logical “table” with 31 columns (one for every Elixhauser comorbidity class) and one row for every patient.</p>
<p><code>icd</code> and <code>coder</code> gives this “table” as a logical (boolean) matrix with patient id as row names. Each package does however sort their matrices in different orders by default.</p>
<p>The output from <code>comorbidities.icd10</code> is more complex. It is a list wherof one element is a data.frame (not a matrix as stated by the help page) with the desired output. The patient id is found as a factor column within the data frame.</p>
<p>We have to transfer the different outputs before they can be compared:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" data-line-number="1">all_output &lt;-<span class="st"> </span><span class="cf">function</span>(...) {</a>
<a class="sourceLine" id="cb20-2" data-line-number="2">  </a>
<a class="sourceLine" id="cb20-3" data-line-number="3">  <span class="co"># Limit the data</span></a>
<a class="sourceLine" id="cb20-4" data-line-number="4">  x &lt;-<span class="st"> </span><span class="kw">head</span>(x, <span class="dv">100</span>)</a>
<a class="sourceLine" id="cb20-5" data-line-number="5">  </a>
<a class="sourceLine" id="cb20-6" data-line-number="6">  <span class="co"># Calculae results for all functions</span></a>
<a class="sourceLine" id="cb20-7" data-line-number="7">  res &lt;-<span class="st"> </span><span class="kw">lapply</span>(<span class="kw">uneval_list</span>(...), eval)</a>
<a class="sourceLine" id="cb20-8" data-line-number="8">  </a>
<a class="sourceLine" id="cb20-9" data-line-number="9">  <span class="co"># Transform results to comparable forms</span></a>
<a class="sourceLine" id="cb20-10" data-line-number="10">  <span class="cf">if</span> (<span class="op">!</span><span class="kw">is.null</span>(res<span class="op">$</span>coder)) </a>
<a class="sourceLine" id="cb20-11" data-line-number="11">    res<span class="op">$</span>coder &lt;-<span class="st">  </span>res<span class="op">$</span>coder[<span class="kw">order</span>(<span class="kw">rownames</span>(res<span class="op">$</span>coder)), ]</a>
<a class="sourceLine" id="cb20-12" data-line-number="12">  </a>
<a class="sourceLine" id="cb20-13" data-line-number="13">  <span class="cf">if</span> (<span class="op">!</span><span class="kw">is.null</span>(res<span class="op">$</span>comorbidities.icd10)) {</a>
<a class="sourceLine" id="cb20-14" data-line-number="14">    id &lt;-<span class="st"> </span><span class="kw">as.character</span>(res<span class="op">$</span>comorbidities.icd10<span class="op">$</span>cmrbdt<span class="op">$</span>id)</a>
<a class="sourceLine" id="cb20-15" data-line-number="15">    x &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(res<span class="op">$</span>comorbidities.icd10<span class="op">$</span>cmrbdt[, <span class="dv">-1</span>])</a>
<a class="sourceLine" id="cb20-16" data-line-number="16">    <span class="kw">rownames</span>(x) &lt;-<span class="st"> </span>id</a>
<a class="sourceLine" id="cb20-17" data-line-number="17">    res<span class="op">$</span>comorbidities.icd10 &lt;-<span class="st"> </span>x[<span class="kw">order</span>(id), ]</a>
<a class="sourceLine" id="cb20-18" data-line-number="18">  }</a>
<a class="sourceLine" id="cb20-19" data-line-number="19">  res</a>
<a class="sourceLine" id="cb20-20" data-line-number="20">}</a></code></pre></div>
<p>We first conclude that column order is the same although class names are articulated slightly different (the <code>icd</code> package offer possibilities for more descriptive names as well):</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" data-line-number="1">res &lt;-<span class="st"> </span><span class="kw">all_output</span>()</a>
<a class="sourceLine" id="cb21-2" data-line-number="2"></a>
<a class="sourceLine" id="cb21-3" data-line-number="3"><span class="kw">as.data.frame</span>(<span class="kw">lapply</span>(res, colnames)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb21-4" data-line-number="4"><span class="st">  </span>knitr<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/knitr/topics/kable">kable</a></span>()</a></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">coder</th>
<th align="left">icd</th>
<th align="left">comorbidities.icd10</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">congestive heart failure</td>
<td align="left">CHF</td>
<td align="left">CHF</td>
</tr>
<tr class="even">
<td align="left">cardiac arrhythmias</td>
<td align="left">Arrhythmia</td>
<td align="left">ARRHYTHMIA</td>
</tr>
<tr class="odd">
<td align="left">valvular disease</td>
<td align="left">Valvular</td>
<td align="left">VALVE</td>
</tr>
<tr class="even">
<td align="left">pulmonary circulation disorder</td>
<td align="left">PHTN</td>
<td align="left">PULM.CIRC</td>
</tr>
<tr class="odd">
<td align="left">peripheral vascular disorder</td>
<td align="left">PVD</td>
<td align="left">PVD</td>
</tr>
<tr class="even">
<td align="left">hypertension uncomplicated</td>
<td align="left">HTN</td>
<td align="left">HTN.UNCOMP</td>
</tr>
<tr class="odd">
<td align="left">hypertension complicated</td>
<td align="left">HTNcx</td>
<td align="left">HTN.COMP</td>
</tr>
<tr class="even">
<td align="left">paralysis</td>
<td align="left">Paralysis</td>
<td align="left">PARALYSIS</td>
</tr>
<tr class="odd">
<td align="left">other neurological disorders</td>
<td align="left">NeuroOther</td>
<td align="left">NEURO.OTHER</td>
</tr>
<tr class="even">
<td align="left">chronic pulmonary disease</td>
<td align="left">Pulmonary</td>
<td align="left">CHRONIC.PULM</td>
</tr>
<tr class="odd">
<td align="left">diabetes uncomplicated</td>
<td align="left">DM</td>
<td align="left">DM.UNCOMP</td>
</tr>
<tr class="even">
<td align="left">diabetes complicated</td>
<td align="left">DMcx</td>
<td align="left">DM.COMP</td>
</tr>
<tr class="odd">
<td align="left">hypothyroidism</td>
<td align="left">Hypothyroid</td>
<td align="left">HYPOTHYROID</td>
</tr>
<tr class="even">
<td align="left">renal failure</td>
<td align="left">Renal</td>
<td align="left">RENAL</td>
</tr>
<tr class="odd">
<td align="left">liver disease</td>
<td align="left">Liver</td>
<td align="left">LIVER</td>
</tr>
<tr class="even">
<td align="left">peptic ulcer disease</td>
<td align="left">PUD</td>
<td align="left">PUD</td>
</tr>
<tr class="odd">
<td align="left">AIDS/HIV</td>
<td align="left">HIV</td>
<td align="left">HIV</td>
</tr>
<tr class="even">
<td align="left">lymphoma</td>
<td align="left">Lymphoma</td>
<td align="left">LYMPHOMA</td>
</tr>
<tr class="odd">
<td align="left">metastatic cancer</td>
<td align="left">Mets</td>
<td align="left">METS</td>
</tr>
<tr class="even">
<td align="left">solid tumor</td>
<td align="left">Tumor</td>
<td align="left">SOLID.TUMOR</td>
</tr>
<tr class="odd">
<td align="left">rheumatoid arthritis</td>
<td align="left">Rheumatic</td>
<td align="left">RHEUM</td>
</tr>
<tr class="even">
<td align="left">coagulopathy</td>
<td align="left">Coagulopathy</td>
<td align="left">COAG</td>
</tr>
<tr class="odd">
<td align="left">obesity</td>
<td align="left">Obesity</td>
<td align="left">OBESITY</td>
</tr>
<tr class="even">
<td align="left">weight loss</td>
<td align="left">WeightLoss</td>
<td align="left">WT.LOSS</td>
</tr>
<tr class="odd">
<td align="left">fluid electrolyte disorders</td>
<td align="left">FluidsLytes</td>
<td align="left">LYTES</td>
</tr>
<tr class="even">
<td align="left">blood loss anemia</td>
<td align="left">BloodLoss</td>
<td align="left">ANEMIA.LOSS</td>
</tr>
<tr class="odd">
<td align="left">deficiency anemia</td>
<td align="left">Anemia</td>
<td align="left">ANEMIA.DEF</td>
</tr>
<tr class="even">
<td align="left">alcohol abuse</td>
<td align="left">Alcohol</td>
<td align="left">ETOH</td>
</tr>
<tr class="odd">
<td align="left">drug abuse</td>
<td align="left">Drugs</td>
<td align="left">DRUGS</td>
</tr>
<tr class="even">
<td align="left">psychoses</td>
<td align="left">Psychoses</td>
<td align="left">PSYCHOSES</td>
</tr>
<tr class="odd">
<td align="left">depression</td>
<td align="left">Depression</td>
<td align="left">DEPRESSION</td>
</tr>
</tbody>
</table>
<p>We hope to have achieved the same result for each patient and each comorbidity class.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" data-line-number="1">different &lt;-<span class="st"> </span>res<span class="op">$</span>coder <span class="op">!=</span><span class="st"> </span>res<span class="op">$</span>icd <span class="op">|</span><span class="st"> </span>res<span class="op">$</span>icd <span class="op">!=</span><span class="st"> </span>res<span class="op">$</span>comorbidities.icd10</a></code></pre></div>
<p>Were there any differences observed? <code>any(different)</code> says: FALSE (which is intended)!</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#other-icd-packages">Other ICD packages</a></li>
      <li><a href="#packages-to-compare">Packages to compare</a></li>
      <li>
<a href="#speed-comparison">Speed comparison</a><ul class="nav nav-pills nav-stacked">
<li><a href="#some-reasons-for-speed-differences">Some reasons for speed differences</a></li>
      <li><a href="#a-note-on-rro">A note on RRO</a></li>
      </ul>
</li>
      <li><a href="#output">Output</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by <a href="https://github.org/eribul">Erik Bulow</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  

  </body>
</html>

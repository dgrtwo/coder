# coder 
[![R build status](https://github.com/eribul/coder/workflows/R-CMD-check/badge.svg)](https://github.com/eribul/coder/actions)
[![Build Status](https://travis-ci.org/eribul/coder.svg?branch=master)](https://travis-ci.org/eribul/coder)
[![AppVeyor Build Status](https://ci.appveyor.com/api/projects/status/github/eribul/coder?branch=master&svg=true)](https://ci.appveyor.com/project/eribul/coder)
[![codecov](https://codecov.io/gh/eribul/coder/branch/master/graph/badge.svg)](https://codecov.io/gh/eribul/coder)
[![Project Status: Active â€“ The project has reached a stable, usable state and is being actively developed.](https://www.repostatus.org/badges/latest/active.svg)](https://www.repostatus.org/#active)


<!-- README.md is generated from README.Rmd. Please edit that file --> 

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README",
  out.width = "100%"
)

library(tidyverse)

```

The goal of `coder` is to classify items from one dataset, using codes from a secondary source with classification schemes based on regular expressions and weighted indices. Default classification schemes (classcodes objects) are focused on patients classified by diagnoses, comorbidities, adverse events and medications.

## Installation

You can (soon) install the released version of coder from [CRAN](https://CRAN.R-project.org) with:

``` r
# install.packages("coder") # Not yet!
```

And the development version from [GitHub](https://github.com/) with:

``` r
# install.packages("remotes")
remotes::install_github("eribul/coder")
```

## Usage

Assume we have some patients with corresponding dates of interest:
```{r}
library(coder)
head(ex_people) %>% knitr::kable()
```
We also have some external medical data (ICD-10-codes recorded at previous hospital):

```{r}
head(ex_icd10) %>% knitr::kable()
```

Using those two sources, as well as a classification scheme (see below), we can easily identify all Charlson co-morbidities during one year prior to the event of interest.

```{r}
ch <- 
  categorize(
    head(ex_people), ex_icd10, "charlson",
    id = "name",
    index = c("quan_original", "quan_updated"),
    codify_args = list(date = "event", days = c(-365, -1))
  )
```

The result is a dataset with columns for each comorbidity and (optional) each weighted index (quan_original and quan_updated):

```{r}
dplyr::select(ch, name, quan_original, quan_updated) %>% knitr::kable()
```



## Classification schemes

Classification schemes (`classcodes` objects) are based on regular expressions for computational speed, but their content can be summarized and visualized for clarity.  Arbitrary `classcodes` objects can also be specified by the user. 

### Default classcodes

The package includes default `classcodes` for medical patient data based on the international classification of diseases version 8, 9 and 10 (ICD-8/9/10), as well as the Anatomical Therapeutic Chemical Classification System (ATC) for medical prescription data.

Default `classcades` are listed in the table. Each classification (classcodes column) can be based on several code systems (regex column) and have several alternative weighted indices (indices column). Those might be combined freely. 

```{r, echo = FALSE}
knitr::kable(coder::all_classcodes()) 
```

# Relation to other packages

`coder` uses `data.table` as a backend to increase computational speed for large datasets. There are some R packages with a narrow focus on Charlson and Elixhauser co-morbidity based on ICD-codes ([icd ](https://CRAN.R-project.org/package=icd), [comorbidity](https://CRAN.R-project.org/package=comorbidity), [medicalrisk ](https://CRAN.R-project.org/package=medicalrisk), [comorbidities.icd10 ](https://github.com/gforge/comorbidities.icd10), [icdcoder](https://github.com/wtcooper/icdcoder)). The `coder` package includes similar functionalities but has a wider scope.

# Citation

```{r, warning=FALSE}
citation("coder")
```


# Contribution

Contributions to this package are welcome. The preferred method of contribution is through a github pull request. Feel free to contact me by creating an issue. Please note that this project is released with a [Contributor Code of Conduct](CODE_OF_CONDUCT.md).
By participating in this project you agree to abide by its terms.

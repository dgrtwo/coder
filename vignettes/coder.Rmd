---
title: "coder"
author: "Erik Bulow"
date: "`r Sys.Date()`"
output: 
  rmarkdown::html_vignette:
    df_print: "kable"
vignette: >
  %\VignetteIndexEntry{coder}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

This vignette will demonstrate the core functionality of the "coder" package by a trivial example. 

# Car ownership

Let's assume we have a list of people, as well as dates for their driving license:

```{r}

library(coder)

people <- 
  data.frame(
    name = c(
      "Medina, Desmand", "al-Hashem,  Muzna", "el-Kaleel, Aadil", "Pettsson, Svenne"
    ),
    license = as.Date(c(
      "1949-05-23", "2016-03-04", "2019-12-18", "1985-05-04"
    )),
    stringsAsFactors = FALSE
  )
```

We also have a car registry with car ownership for 1,000 cars (with `code_date` the date when the car was bought):

```{r}
head(ex_cars)
```

We are not interested in individual brand names of each car, but we want to know who owns a car made by a specific company.
We can specify a classification scheme of brands related to each company (a `classcodes` object).
Note that not all models are classified.
The classification scheme is made by regular expressions since these are more effective to work with for classification of large data sets.


```{r}
ex_carbrands
```


# Categorize 

We want to know if anyone owns a car from a company that we are interested in.

We use the three objects from above:

* `people`: the people we are interested in,
* `ex_cars`: the centralized car registry and
* `ex_carbrands`: the classification of car makers. 

```{r}
(x <- categorize(people, ex_cars, ex_carbrands, id = "name"))
```

# Interpretation

We can see that:

* Emily Aziz owns a Mazda. 
* Lauren Albrecht owns both a Mercedes and a Toyota.
* Christopher Gavin might in fact own a car, but none of the ones we are interested in.
* Svenne Petsson is a Swede and is not found in our American car register.

The `index` column is here the sum of identified cars owned by each person.

Note that each column identifies if a person owns **at least one** car from the relevant company.


# Cars owned before license

We can use the date columns to check if anyone owned a car already before they got their drivers license.
We need to specify that the date column is called `license`.
The `days` argument specifies that we are interested in cars bought before this date.

```{r}
(x <- 
   categorize(
     people, 
     ex_cars, 
     ex_carbrands, 
     id = "name", 
     codify_args = list(
       date = "license", 
       days = c(-Inf, -1)
     )
  )
)
```

Indeed, someone did buy some cars before taking a drivers license! 


# Car rating

We are not only interested in the number of cars owned by each individual. 
We would also like to rate the cars based on the manufacturer. Let us assign some score to each company.
We then specifies that the index should be calculated based on the new column named "score".

```{r}
ex_carbrands$score <- c(10, 1, 2, 1, 1, 2, 3)

(x <- categorize(people, ex_cars, ex_carbrands, id = "name", ind = "score"))
```


# Concluding remark

This vignette illustrates a simple example where the data sets are small, and the coding schemes are trivial. 
If that is the case, it might be equally good to just join or merge the data sets manually. 
A more realistic example of when the package might come handy is presented in the vignette called "Comorbidity".

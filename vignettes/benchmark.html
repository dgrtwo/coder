<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="Erik Bulow" />

<meta name="date" content="2016-08-11" />

<title>Benchmarking</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>



<link href="data:text/css;charset=utf-8,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23header%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0A%7D%0Apre%20%7B%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%20code%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" rel="stylesheet" type="text/css" />

</head>

<body>




<h1 class="title toc-ignore">Benchmarking</h1>
<h4 class="author"><em>Erik Bulow</em></h4>
<h4 class="date"><em>2016-08-11</em></h4>



<div id="other-icd-packages" class="section level1">
<h1>Other ICD packages</h1>
<p>The <code>classifyr</code> package is not the only (nor the first) R package aimed for ICD codes and comorbitity indexes. Four additional packages (as listed below) were found as by 2016-04-14.</p>
<table>
<colgroup>
<col width="19%"></col>
<col width="17%"></col>
<col width="6%"></col>
<col width="25%"></col>
<col width="30%"></col>
</colgroup>
<thead>
<tr class="header">
<th>Package</th>
<th>Authour</th>
<th>CRAN</th>
<th>GitHub</th>
<th>ICD versions</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>icd</td>
<td>Jack Wasey</td>
<td>X</td>
<td>jackwasey/icd</td>
<td>ICD9, ICD10, ICD-10-CM</td>
</tr>
<tr class="even">
<td>medicalrisk</td>
<td>Patrick McCormick</td>
<td>X</td>
<td>patrickmdnet/medicalrisk</td>
<td>ICD-9-CM</td>
</tr>
<tr class="odd">
<td>comorbidities.icd10</td>
<td>Max Gordon</td>
<td></td>
<td>gforge/comorbidities.icd10</td>
<td>ICD-9, ICD-10 (US/SWE)</td>
</tr>
<tr class="even">
<td>icdcoder</td>
<td>Wade Cooper</td>
<td></td>
<td>wtcooper/icdcoder</td>
<td>ICD9, ICD-9-CM, ICD10, ICD-10-CM</td>
</tr>
</tbody>
</table>
</div>
<div id="packages-to-compare" class="section level1">
<h1>Packages to compare</h1>
<p>The <code>classifyr</code> package was initilly targeted for Swedish ICD data. Since Sweden (as opposed to USA) use mostly ICD-10 codes (in favour of ICD-9), the <code>medicalrisk</code> package is dropped from further comparisons.</p>
<p>The <code>icdcoder</code> package is not submitted to CRAN and inspection of the source code reveals that the package does not yet seem to be ready for production release (it does for example have some problems with its dependency packages). According to GitHub metrics, the development activity has been quite limited and we therefore assume that the package is not under active development. It is therefore not considered further within this comparison.</p>
</div>
<div id="speed-comparison" class="section level1">
<h1>Speed comparison</h1>
<p>Calling functions from both <code>icd</code> and <code>comorbidities.icd10</code> by full reference (e. g. <code>package::fun</code>) is problematic due to internal use of non standard evaluation. All compared packages are therefore first attached (by <code>library</code>):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(classifyr)
<span class="kw">suppressPackageStartupMessages</span>(<span class="kw">library</span>(icd))
<span class="kw">suppressPackageStartupMessages</span>(<span class="kw">library</span>(comorbidities.icd10))

<span class="kw">library</span>(dplyr) <span class="co"># For data management</span></code></pre></div>
<p>Benchmarking will be performed by calculating Elixhauser comorbidity classes based on ICD-10 codes by corresponding functions from the <code>icd</code>, <code>classifyr</code> and <code>comorbidities.icd10</code> packages.</p>
<p>First some session info:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">si &lt;-<span class="st"> </span>devtools::<span class="kw">session_info</span>(<span class="kw">c</span>(<span class="st">&quot;icd&quot;</span>, <span class="st">&quot;classifyr&quot;</span>, <span class="st">&quot;comorbidities.icd10&quot;</span>))
si$packages &lt;-<span class="st"> </span>
<span class="st">  </span>si$packages %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(package %in%<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;icd&quot;</span>, <span class="st">&quot;classifyr&quot;</span>, <span class="st">&quot;comorbidities.icd10&quot;</span>)) %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">select</span>(-source)
si</code></pre></div>
<pre><code>## Session info --------------------------------------------------------------</code></pre>
<pre><code>##  setting  value                       
##  version  R version 3.3.1 (2016-06-21)
##  system   x86_64, mingw32             
##  ui       RStudio (0.99.1197)         
##  language (EN)                        
##  collate  Swedish_Sweden.1252         
##  tz       Europe/Berlin               
##  date     2016-08-11</code></pre>
<pre><code>## Packages ------------------------------------------------------------------</code></pre>
<pre><code>##               package *    version       date
## 1           classifyr *      0.0.5 2016-08-11
## 2 comorbidities.icd10 *      0.6.2 2016-08-11
## 3                 icd * 2.0.1.9000 2016-08-11</code></pre>
<p>We prepare a function to return a list with unevaluated calls to correspinding functions in specified packages:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">uneval_list &lt;-<span class="st"> </span>function(<span class="dt">pkgs =</span> <span class="kw">c</span>(<span class="st">&quot;classifyr&quot;</span>, <span class="st">&quot;icd&quot;</span>, <span class="st">&quot;comorbidities.icd10&quot;</span>)) {
  
  <span class="co"># Initiate a list of expressions to benchmark</span>
  expr &lt;-<span class="st"> </span><span class="kw">list</span>()
  
  <span class="co"># Include function &quot;classify&quot; from package &quot;classifyr&quot;</span>
  if (<span class="st">&quot;classifyr&quot;</span> %in%<span class="st"> </span>pkgs) expr$classifyr &lt;-<span class="st"> </span><span class="kw">substitute</span>(
    
    <span class="kw">classify</span>(
      x, 
      <span class="dt">by =</span> <span class="st">&quot;elix_icd10&quot;</span>, 
      <span class="dt">id =</span> <span class="st">&quot;id&quot;</span>)
    )
  
  <span class="co"># Include function &quot;icd_comorbid&quot; from package &quot;icd&quot;</span>
  if (<span class="st">&quot;icd&quot;</span> %in%<span class="st"> </span>pkgs) expr$icd &lt;-<span class="st"> </span><span class="kw">substitute</span>( 
    
    <span class="kw">icd_comorbid</span>(
      dplyr::<span class="kw">mutate</span>(
        x, 
        <span class="dt">id =</span> <span class="kw">as.character</span>(id), 
        <span class="dt">code =</span> <span class="kw">as.character</span>(code)), 
      icd10_map_quan_elix, 
      <span class="dt">visit_name =</span> <span class="st">&quot;id&quot;</span>, 
      <span class="dt">icd_name =</span> <span class="st">&quot;code&quot;</span>)
    )
  
  <span class="co"># Include function &quot;cmrbdt.calc&quot; from package &quot;comorbid.icd10&quot;</span>
  if (<span class="st">&quot;comorbidities.icd10&quot;</span> %in%<span class="st"> </span>pkgs) expr$comorbidities.icd10 &lt;-<span class="st"> </span><span class="kw">substitute</span>( 
    
    <span class="kw">cmrbdt.calc</span>(
      x, 
      <span class="st">&quot;id&quot;</span>, 
      <span class="st">&quot;code&quot;</span>, 
      <span class="kw">rep</span>(<span class="st">&quot;10&quot;</span>, <span class="kw">nrow</span>(x)), 
      <span class="dt">cmrbdt.finder_fn =</span> cmrbdt.finder.regex.elixhauser_Quan2005)
    )
  
  expr
}</code></pre></div>
<p>We make another function to use for benchmarking</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">bm &lt;-<span class="st"> </span>function(<span class="dt">pkgs =</span> <span class="kw">c</span>(<span class="st">&quot;classifyr&quot;</span>, <span class="st">&quot;icd&quot;</span>, <span class="st">&quot;comorbidities.icd10&quot;</span>), ...) {
  microbenchmark::<span class="kw">microbenchmark</span>(<span class="dt">list =</span> <span class="kw">uneval_list</span>(pkgs), ...) %&gt;%
<span class="st">  </span><span class="kw">summary</span>() %&gt;%<span class="st"> </span>
<span class="st">  </span>knitr::<span class="kw">kable</span>(<span class="dt">digits =</span> <span class="dv">2</span>)
}</code></pre></div>
<p>We will use a randomly generated (totaly “fake”/non personal) dataset of size 10,000. This is of quite moderate size compared to real world data but will be sufficient for now.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(x &lt;-<span class="st"> </span>dplyr::<span class="kw">sample_n</span>(classifyr::ex_icd10, <span class="fl">1e4</span>, <span class="ot">TRUE</span>))</code></pre></div>
<pre><code>## # A tibble: 6 x 3
##                  id       date   code
##              &lt;fctr&gt;     &lt;date&gt; &lt;fctr&gt;
## 1       Garvin, Joy 2016-01-07   T257
## 2  Wolverton, Julia 2015-10-23   B500
## 3       Tran, Diego 2015-11-26   M711
## 4       Mills, Jody 2015-12-17   Q447
## 5    Jackson, Amber 2015-04-19   Q110
## 6 Ruiz-Smith, Angie 2015-07-13   S935</code></pre>
<p>The test data set does contain some codes beginning in “UA”, “UB” and/or “UP”. These are valid codes in the Swedish ICD 10 (2016) version but will not be recognised as such by <code>comorbidities.icd10</code>. They must therefore be excluded in order to proced:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x &lt;-<span class="st"> </span>dplyr::<span class="kw">filter</span>(x, !<span class="kw">grepl</span>(<span class="st">&quot;U[ABP]&quot;</span>, code))</code></pre></div>
<p>A data set of 9934 is now remaining.</p>
<p>Results in seconds:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">bm</span>(<span class="dt">times =</span> <span class="dv">5</span>, <span class="dt">unit =</span> <span class="st">&quot;s&quot;</span>)</code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">expr</th>
<th align="right">min</th>
<th align="right">lq</th>
<th align="right">mean</th>
<th align="right">median</th>
<th align="right">uq</th>
<th align="right">max</th>
<th align="right">neval</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">classifyr</td>
<td align="right">0.08</td>
<td align="right">0.08</td>
<td align="right">0.08</td>
<td align="right">0.08</td>
<td align="right">0.08</td>
<td align="right">0.08</td>
<td align="right">5</td>
</tr>
<tr class="even">
<td align="left">icd</td>
<td align="right">6.27</td>
<td align="right">6.27</td>
<td align="right">6.39</td>
<td align="right">6.42</td>
<td align="right">6.46</td>
<td align="right">6.52</td>
<td align="right">5</td>
</tr>
<tr class="odd">
<td align="left">comorbidities.icd10</td>
<td align="right">35.56</td>
<td align="right">35.61</td>
<td align="right">35.81</td>
<td align="right">35.63</td>
<td align="right">35.72</td>
<td align="right">36.53</td>
<td align="right">5</td>
</tr>
</tbody>
</table>
<p>Relative speed differences (with the fastest package used as reference):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">bm</span>(<span class="dt">times =</span> <span class="dv">5</span>, <span class="dt">unit =</span> <span class="st">&quot;relative&quot;</span>)</code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">expr</th>
<th align="right">min</th>
<th align="right">lq</th>
<th align="right">mean</th>
<th align="right">median</th>
<th align="right">uq</th>
<th align="right">max</th>
<th align="right">neval</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">classifyr</td>
<td align="right">1.00</td>
<td align="right">1.00</td>
<td align="right">1.00</td>
<td align="right">1.00</td>
<td align="right">1.00</td>
<td align="right">1.00</td>
<td align="right">5</td>
</tr>
<tr class="even">
<td align="left">icd</td>
<td align="right">83.15</td>
<td align="right">82.98</td>
<td align="right">79.82</td>
<td align="right">79.78</td>
<td align="right">76.84</td>
<td align="right">76.89</td>
<td align="right">5</td>
</tr>
<tr class="odd">
<td align="left">comorbidities.icd10</td>
<td align="right">470.95</td>
<td align="right">469.82</td>
<td align="right">453.58</td>
<td align="right">449.50</td>
<td align="right">438.02</td>
<td align="right">442.20</td>
<td align="right">5</td>
</tr>
</tbody>
</table>
<p>We thus conclude that <code>classifyr</code> is faster than its competitors!</p>
<div id="some-reasons-for-speed-differences" class="section level2">
<h2>Some reasons for speed differences</h2>
<ul>
<li>Both <code>icd</code> and <code>classifyr</code> relies on matrices, while <code>comorbidities.icd10</code> uses data frames. Matrices are generally faster both due to its simpler structure (in this case logical/boolean while the data frame can have different types of classes for each column) and since matrices can be handled effectively through underlying (sub R) numerical C/C++/Fortran librarys such as LAPACK and BLAS.</li>
<li><code>classifyr</code> relies on compact regular expressions for classification. <code>comorbidities.icd10</code> can use regular expressions too (as done above) but the format is less compact. <code>icd</code> uses “raw” ICD-10 codes and “search for each possible parent of the given code, up to the three digit ‘major’” (<a href="https://cran.r-project.org/web/packages/icd/vignettes/icd-10.html" class="uri">https://cran.r-project.org/web/packages/icd/vignettes/icd-10.html</a>). (It might however be recorded as a side note that the <code>icd</code> package does rely on a (much) faster procedure when used with ICD-9 codes.)</li>
</ul>
</div>
<div id="a-note-on-rro" class="section level2">
<h2>A note on RRO</h2>
<p>Comparisons above shows result for the latest (released) R version (details shown above).</p>
<p>Even though we would not present any details here, the same benchamrk was performed also on the latest available version (3.2.4) of Revolution R Open (RRO) with both one and then multiple (4) cores. This was done on an Intel i7 machine (an architecture supposed to take full advantage of the Intel Math Kernel Library used by RRO).</p>
<p>There were no relevant difference observed between one and 4 kernels. The <code>icd</code> package did perform better with RRO while <code>classifyr</code> and <code>comorbidities.icd10</code> were performing worse. The ranking among the packages were the same as above although the magnitude of the relative differneces were decreased between <code>classifyr</code> and <code>icd</code>.</p>
</div>
</div>
<div id="output" class="section level1">
<h1>Output</h1>
<p>It is abviously important also to compare the output of each function. The basic output from all functions is a logical “table” with 31 columns (one for every Elixhauser comorbidity class) and one row for every patient.</p>
<p><code>icd</code> and <code>classifyr</code> gives this “table” as a logical (boolean) matrix with patient id as row names. Each package does however sort their matrices in different orders by default.</p>
<p>The output from <code>comorbidities.icd10</code> is more complex. It is a list wherof one element is a data.frame (not a matrix as stated by the help page) with the desired output. The patient id is found as a factor column within the data frame.</p>
<p>We have to transfer the different outputs before they can be compared:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">all_output &lt;-<span class="st"> </span>function(...) {
  
  <span class="co"># Limit the data</span>
  x &lt;-<span class="st"> </span><span class="kw">head</span>(x, <span class="dv">100</span>)
  
  <span class="co"># Calculae results for all functions</span>
  res &lt;-<span class="st"> </span><span class="kw">lapply</span>(<span class="kw">uneval_list</span>(...), eval)
  
  <span class="co"># Transform results to comparable forms</span>
  if (!<span class="kw">is.null</span>(res$classifyr)) 
    res$classifyr &lt;-<span class="st">  </span>res$classifyr[<span class="kw">order</span>(<span class="kw">rownames</span>(res$classifyr)), ]
  
  if (!<span class="kw">is.null</span>(res$comorbidities.icd10)) {
    id &lt;-<span class="st"> </span><span class="kw">as.character</span>(res$comorbidities.icd10$cmrbdt$id)
    x &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(res$comorbidities.icd10$cmrbdt[, -<span class="dv">1</span>])
    <span class="kw">rownames</span>(x) &lt;-<span class="st"> </span>id
    res$comorbidities.icd10 &lt;-<span class="st"> </span>x[<span class="kw">order</span>(id), ]
  }
  res
}</code></pre></div>
<p>We first conclude that column order is the same although class names are articulated slightly different (the <code>icd</code> package offer possibilities for more descriptive names as well):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">res &lt;-<span class="st"> </span><span class="kw">all_output</span>()

<span class="kw">as.data.frame</span>(<span class="kw">lapply</span>(res, colnames)) %&gt;%<span class="st"> </span>
<span class="st">  </span>knitr::<span class="kw">kable</span>()</code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">classifyr</th>
<th align="left">icd</th>
<th align="left">comorbidities.icd10</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">congestive_heart_failure</td>
<td align="left">CHF</td>
<td align="left">CHF</td>
</tr>
<tr class="even">
<td align="left">cardiac_arrhythmias</td>
<td align="left">Arrhythmia</td>
<td align="left">ARRHYTHMIA</td>
</tr>
<tr class="odd">
<td align="left">valvular_disease</td>
<td align="left">Valvular</td>
<td align="left">VALVE</td>
</tr>
<tr class="even">
<td align="left">pulmonary_circulationd_disorder</td>
<td align="left">PHTN</td>
<td align="left">PULM.CIRC</td>
</tr>
<tr class="odd">
<td align="left">peripheral_vascular_disorder</td>
<td align="left">PVD</td>
<td align="left">PVD</td>
</tr>
<tr class="even">
<td align="left">hypertension_uncomplicated</td>
<td align="left">HTN</td>
<td align="left">HTN.UNCOMP</td>
</tr>
<tr class="odd">
<td align="left">hypertension_complicated</td>
<td align="left">HTNcx</td>
<td align="left">HTN.COMP</td>
</tr>
<tr class="even">
<td align="left">paralysis</td>
<td align="left">Paralysis</td>
<td align="left">PARALYSIS</td>
</tr>
<tr class="odd">
<td align="left">other_neurological_disorders</td>
<td align="left">NeuroOther</td>
<td align="left">NEURO.OTHER</td>
</tr>
<tr class="even">
<td align="left">chronic_pulmonary_disease</td>
<td align="left">Pulmonary</td>
<td align="left">CHRONIC.PULM</td>
</tr>
<tr class="odd">
<td align="left">diabetes_uncomplicated</td>
<td align="left">DM</td>
<td align="left">DM.UNCOMP</td>
</tr>
<tr class="even">
<td align="left">diabetes_complicated</td>
<td align="left">DMcx</td>
<td align="left">DM.COMP</td>
</tr>
<tr class="odd">
<td align="left">hypothyroidism</td>
<td align="left">Hypothyroid</td>
<td align="left">HYPOTHYROID</td>
</tr>
<tr class="even">
<td align="left">renal_failure</td>
<td align="left">Renal</td>
<td align="left">RENAL</td>
</tr>
<tr class="odd">
<td align="left">liver_disease</td>
<td align="left">Liver</td>
<td align="left">LIVER</td>
</tr>
<tr class="even">
<td align="left">peptic_ulcer_disease</td>
<td align="left">PUD</td>
<td align="left">PUD</td>
</tr>
<tr class="odd">
<td align="left">aids_hiv</td>
<td align="left">HIV</td>
<td align="left">HIV</td>
</tr>
<tr class="even">
<td align="left">lymphoma</td>
<td align="left">Lymphoma</td>
<td align="left">LYMPHOMA</td>
</tr>
<tr class="odd">
<td align="left">metastatic_cancer</td>
<td align="left">Mets</td>
<td align="left">METS</td>
</tr>
<tr class="even">
<td align="left">solid_tumor</td>
<td align="left">Tumor</td>
<td align="left">SOLID.TUMOR</td>
</tr>
<tr class="odd">
<td align="left">rheumatoid_arthritis</td>
<td align="left">Rheumatic</td>
<td align="left">RHEUM</td>
</tr>
<tr class="even">
<td align="left">coagulopathy</td>
<td align="left">Coagulopathy</td>
<td align="left">COAG</td>
</tr>
<tr class="odd">
<td align="left">obesity</td>
<td align="left">Obesity</td>
<td align="left">OBESITY</td>
</tr>
<tr class="even">
<td align="left">weight_loss</td>
<td align="left">WeightLoss</td>
<td align="left">WT.LOSS</td>
</tr>
<tr class="odd">
<td align="left">fluid_electrolyte_disorders</td>
<td align="left">FluidsLytes</td>
<td align="left">LYTES</td>
</tr>
<tr class="even">
<td align="left">blood_loss_anemia</td>
<td align="left">BloodLoss</td>
<td align="left">ANEMIA.LOSS</td>
</tr>
<tr class="odd">
<td align="left">deficiency_anemia</td>
<td align="left">Anemia</td>
<td align="left">ANEMIA.DEF</td>
</tr>
<tr class="even">
<td align="left">alcohol_abuse</td>
<td align="left">Alcohol</td>
<td align="left">ETOH</td>
</tr>
<tr class="odd">
<td align="left">drug_abuse</td>
<td align="left">Drugs</td>
<td align="left">DRUGS</td>
</tr>
<tr class="even">
<td align="left">psychoses</td>
<td align="left">Psychoses</td>
<td align="left">PSYCHOSES</td>
</tr>
<tr class="odd">
<td align="left">depression</td>
<td align="left">Depression</td>
<td align="left">DEPRESSION</td>
</tr>
</tbody>
</table>
<p>We hope to have achieved the same result for each patient and each comorbidity class.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">different &lt;-<span class="st"> </span>res$classifyr !=<span class="st"> </span>res$icd |<span class="st"> </span>res$icd !=<span class="st"> </span>res$comorbidities.icd10</code></pre></div>
<p>Were there any differences observed? <code>any(different)</code> says: FALSE (which is intended)!</p>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>

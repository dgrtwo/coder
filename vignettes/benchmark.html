<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />
<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="Erik Bulow" />

<meta name="date" content="2016-04-26" />

<title>Benchmarking</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>


<link href="data:text/css;charset=utf-8,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23header%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0A%7D%0Apre%20%7B%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%20code%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" rel="stylesheet" type="text/css" />

</head>

<body>



<div class="fluid-row" id="header">


<h1 class="title">Benchmarking</h1>
<h4 class="author"><em>Erik Bulow</em></h4>
<h4 class="date"><em>2016-04-26</em></h4>

</div>


<div id="other-icd-packages" class="section level1">
<h1>Other ICD packages</h1>
<p>The <code>icdswe</code> package is not the only (nor the first) R package aimed for ICD codes and comorbitity indexes. Four additional packages (as listed below) were found as by 2016-04-14.</p>
<table>
<colgroup>
<col width="19%"></col>
<col width="17%"></col>
<col width="6%"></col>
<col width="25%"></col>
<col width="30%"></col>
</colgroup>
<thead>
<tr class="header">
<th align="left">Package</th>
<th align="left">Authour</th>
<th align="left">CRAN</th>
<th align="left">GitHub</th>
<th align="left">ICD versions</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">icd</td>
<td align="left">Jack Wasey</td>
<td align="left">X</td>
<td align="left">jackwasey/icd</td>
<td align="left">ICD9, ICD10, ICD-10-CM</td>
</tr>
<tr class="even">
<td align="left">medicalrisk</td>
<td align="left">Patrick McCormick</td>
<td align="left">X</td>
<td align="left">patrickmdnet/medicalrisk</td>
<td align="left">ICD-9-CM</td>
</tr>
<tr class="odd">
<td align="left">comorbidities.icd10</td>
<td align="left">Max Gordon</td>
<td align="left"></td>
<td align="left">gforge/comorbidities.icd10</td>
<td align="left">ICD-9, ICD-10 (US/SWE)</td>
</tr>
<tr class="even">
<td align="left">icdcoder</td>
<td align="left">Wade Cooper</td>
<td align="left"></td>
<td align="left">wtcooper/icdcoder</td>
<td align="left">ICD9, ICD-9-CM, ICD10, ICD-10-CM</td>
</tr>
</tbody>
</table>
</div>
<div id="packages-to-compare" class="section level1">
<h1>Packages to compare</h1>
<p>The <code>icdswe</code> package was initilly targeted for Swedish ICD data. Since Sweden (as opposed to USA) use mostly ICD-10 codes (in favour of ICD-9), the <code>medicalrisk</code> package is dropped from further comparisons.</p>
<p>The <code>icdcoder</code> package is not submitted to CRAN and inspection of the source code reveals that the package does not yet seem to be ready for production release (it does for example have some problems with its dependency packages). According to GitHub metrics, the development activity has been quite limited and we therefore assume that the package is not under active development. It is therefore not considered further within this comparison.</p>
</div>
<div id="speed-comparison" class="section level1">
<h1>Speed comparison</h1>
<p>To work with large datasets of ICD-codes (with millions of cases) is not uncommon wherefore speed is an important performance meassure. We do however limit the comparison here to a data set with 2000 cases:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(x &lt;-<span class="st"> </span>icdswe::pardata[<span class="dv">1</span>:<span class="dv">2000</span>, ])</code></pre></div>
<pre><code>## Source: local data frame [6 x 3]
## 
##       id       date   code
##   &lt;fctr&gt;     &lt;date&gt; &lt;fctr&gt;
## 1 115457 2001-01-01   R339
## 2 180798 2001-01-01   S819
## 3  10396 2001-01-01   S519
## 4 179446 2001-01-01   R539
## 5 216594 2001-01-01   N180
## 6 151485 2001-01-01   N459</code></pre>
<p>Calling functions from both <code>icd</code> and <code>comorbidities.icd10</code> by full reference (e. g. <code>package::fun</code>) is problematic due to internal use of non standard evaluation. All compared packages are therefore first attached (by <code>library</code>).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">suppressPackageStartupMessages</span>(<span class="kw">library</span>(dplyr))
<span class="kw">suppressPackageStartupMessages</span>(<span class="kw">library</span>(icdswe))
<span class="kw">suppressPackageStartupMessages</span>(<span class="kw">library</span>(icd))
<span class="kw">suppressPackageStartupMessages</span>(<span class="kw">library</span>(comorbidities.icd10))</code></pre></div>
<p>Benchmark is performed for corresponding functions from the <code>icd</code>, <code>icdswe</code> and <code>comorbidities.icd10</code> packages.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">rbenchmark::<span class="kw">benchmark</span>(

  <span class="dt">icdswe =</span> <span class="kw">classify</span>(x, <span class="st">&quot;elix_icd10&quot;</span>, <span class="dt">id =</span> <span class="st">&quot;id&quot;</span>),

  <span class="dt">icd    =</span> <span class="kw">icd_comorbid</span>(
            <span class="kw">mutate</span>(x,
              <span class="dt">id =</span> <span class="kw">as.character</span>(id),
              <span class="dt">code =</span> <span class="kw">as.character</span>(code)),
            icd10_map_quan_elix,
            <span class="dt">visit_name =</span> <span class="st">&quot;id&quot;</span>,
            <span class="dt">icd_name =</span> <span class="st">&quot;code&quot;</span>),

  <span class="dt">comorbidities.icd10 =</span>
            <span class="kw">cmrbdt.calc</span>(x,
            <span class="st">&quot;id&quot;</span>,
            <span class="st">&quot;code&quot;</span>,
            <span class="kw">rep</span>(<span class="st">&quot;10&quot;</span>, <span class="kw">nrow</span>(x)),
            <span class="dt">cmrbdt.finder_fn =</span> cmrbdt.finder.regex.elixhauser_Quan2005),

  <span class="co"># Benchmark settings</span>
  <span class="dt">replications =</span> <span class="dv">1</span>,
  <span class="dt">columns =</span> <span class="kw">c</span>(<span class="st">&quot;test&quot;</span>, <span class="st">&quot;elapsed&quot;</span>, <span class="st">&quot;relative&quot;</span>)
) %&gt;%
knitr::<span class="kw">kable</span>()</code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="left">test</th>
<th align="right">elapsed</th>
<th align="right">relative</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">3</td>
<td align="left">comorbidities.icd10</td>
<td align="right">27.11</td>
<td align="right">246.455</td>
</tr>
<tr class="even">
<td align="left">2</td>
<td align="left">icd</td>
<td align="right">1.66</td>
<td align="right">15.091</td>
</tr>
<tr class="odd">
<td align="left">1</td>
<td align="left">icdswe</td>
<td align="right">0.11</td>
<td align="right">1.000</td>
</tr>
</tbody>
</table>
<p>We thus conclude that <code>icdswe</code> is faster than its competitors!</p>
<p>This can be partially explained by choises of underlaying datastructure (matrix versus data.frame where the first is generally much faster than the second).</p>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>

---
title: "Classcodes objects"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Co-morbidity_codes}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(coder)
```

Classification is implemented by classcodes objects with regular expressions identifying different groups. Default classcodes object included in the package are:

```{r}
all_classcodes()$classcodes
```

We will have a closer look at one of those objects, `charlson`, to exemplify its content. The object is basically a data frame ...


```{r}
knitr::kable(charlson)
```


... with some additional attributes:

```{r}
attributes(charlson)
```

# Columns

- The "group" column contains short descriptive names of all groups to classify by. Those names might contain spaces and other special characters which might be transformed when used (argument `tech_names` in `set_classcodes`). 
- Column "description" (optional) provides additional details of each group. 
- All columns prefixed by `regex_` (`attr(charlson, "regexprs")`) specify different versions of group identification based on regular expressions (see `?charlson` for details). Those regular expressions only identifies individual codes but this can be controlled further by arguments `start` and `stop` to `set_classcodes`. 
- Columns named `index_` (`attr(charlson, "indices")`) are numeric variables used as weights when calculating index sums based on all (or a subset of) individual groups.
- Other classcodes objects (see for example `?hip_ae`) might have an additional column "condition", as described in a separate vignette.

# Hierarchy

Some classcodes objects (see for example `?elixhauser`) might have an additional class attribute "hierarchy", controlling hierarchical groups where only one of possibly several groups (occurring simultaneity) should be recognized for calculation of weighted index sums. 


# Interpret the regular expressions

## Visualise graphically

Regular expressions can be difficult to interpret but can be visualized. This will usually display a web page in the default browser (here suppressed by argument `show = FALSE`): 

```{r}
url <- visualize(charlson, show = FALSE, regex = "regex_icd10")
```

In the vignette we can open the `url` "manually" by the [JavaScript Regular Expression Parser & Visualizer](`r url`).

## List all codes

An alternative interpretation is by listing all relevant codes identified by each regular expression. THis is done automatically by the `summary` function:

```{r}
print(
  summary(charlson, coding = "icd10"),
  n = 30
)
```

